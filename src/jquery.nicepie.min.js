/*!jQuery nicepie*/
/**
 * Version: 1.0.0 (2013-06-21)
 * Requires: jQuery v?
 *
 * Copyright (c) 2013 Takis Pournaras
 * Under MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 */
(function($){$.fn.nicepie=function(options){var settings=$.extend({radius:100,backcolor:'#000',piecolor:'#666',fontcolor:'#fff',font:'20pt Ubuntu italic',halign:'center',valign:'middle',suffix:'',show_percent:true,start:100,end:43,step:-1,interval:10},options);var canvas;if(settings.show_percent){settings.start=100;settings.end=Math.max(0,Math.min(100,settings.end))}return this.each(function(){$(this).append('<canvas width="'+settings.radius*2+'" height="'+settings.radius*2+'"></canvas>');canvas=$(this).find('canvas')[0].getContext('2d');var current=settings.start;draw_background();draw_text(current);var anim=setInterval(function(){current=get_next_number(current);clear_canvas();draw_background();if(settings.show_percent)draw_foreground(current);draw_text(current)},settings.interval)});function clear_canvas(){canvas.clearRect(0,0,settings.radius*2,settings.radius*2)}function draw_background(){canvas.beginPath();canvas.moveTo(settings.radius,settings.radius);canvas.arc(settings.radius,settings.radius,settings.radius,Math.PI*0,Math.PI*2,false);canvas.lineTo(settings.radius,settings.radius);canvas.closePath();canvas.fillStyle=settings.backcolor;canvas.fill()}function draw_foreground(percent){canvas.beginPath();canvas.moveTo(settings.radius,settings.radius);canvas.arc(settings.radius,settings.radius,settings.radius,Math.PI*1.5,Math.PI*(1.5-2*(100-percent)/100), true);canvas.lineTo(settings.radius,settings.radius);canvas.closePath();canvas.fillStyle=settings.piecolor;canvas.fill()}function draw_text(number){var text=number_format(number);canvas.font=settings.font;canvas.textAlign=settings.halign;canvas.textBaseline=settings.valign;canvas.fillStyle=settings.fontcolor;canvas.fillText(text,settings.radius,settings.radius)}function get_next_number(current){current=(settings.step>0)?Math.min(current+settings.step,settings.end):Math.max(current+settings.step,settings.end);return current}function number_format(number){var sep=',';var text=number.toString()+'';var rgx=/(\d+)(\d{3})/;while(rgx.test(text)){text=text.replace(rgx,'$1'+sep+'$2')}return text+settings.suffix}}}(jQuery));